(function(){return function(e){function t(e,t,a,r){return e+2<=t.length&&r>=t[e+1][1]-t[e][1]?(r=t[e+1][1]-t[e][1],a.push(t[e][0])):a.push(t[e-1][0]),[e+=2,t,a]}function a(e,t){for(var a,r=[];a=e.exec(t);)r.push([a[0],a.index]),e.lastIndex=a.index+1;return r}function r(e){return e=/\d{2}/.test(e)?e:"0"+e}function n(e){if(!/\d+:\d+(?:\s?[ap]m)?/i.test(e))return null;var t=parseInt(/(\d+):\d+(?:\s?[ap]m)?/i.exec(e)[1]),a=/\d+:(\d+)(?:\s?[ap]m)?/i.exec(e)[1],n=/\d+:\d+\s?([ap]m)?/i.exec(e)[1];return(t=/pm/i.test(n)?12===t?t:t+12:/am/i.test(n)&&12===t?r(0):r(t))+":"+a+":00"}function u(e,t){for(var a=0;a<e.length;a++)if(e[a].start_===t.start_&&e[a].end_===t.end_&&e[a].toString()===t.toString())return!0}var s=loadHelper("flight_date_penalty.js"),p=e[0].span.scanner_,d=new Date(1e3*p.epoch_),i=1e3,l=1,o=1,D=[],_=[];e.forEach(function(e){var t=e.span,a=p.getDetachedSpan(t.parentAnyTag("tr").toString());if(a.end_-a.start_<i){for(var r=a.nextAbsoluteDate(),n=r;u(D,n)&&!n.isNullSpan_;)n=n.nextAbsoluteDate();n.isNullSpan_&&!r.isNullSpan_&&(n=r),n.isNullSpan_||(e.departureDate=unSpanDate_(n),D.push(n))}if(!e.departureDate){var _=t,c=t,f=t.scanner_.getSpan().allAbsoluteDates();if(1===f.length)return void(s(new Date(unSpanDate_(f[0])),d)>=0&&(e.departureDate=unSpanDate_(f[0])));var S=1,h=2;if(_=_.previousAbsoluteDate(),c=c.nextAbsoluteDate(),S=s(new Date(unSpanDate_(_)),d),h=s(new Date(unSpanDate_(c)),d),!_.isNullSpan_&&!c.isNullSpan_){var v=t.start_-_.start_,g=c.start_-t.start_;S+=Math.round(v/g*100)/100,h+=Math.round(g/v*100)/100}_.isNullSpan_&&(S+=10),c.isNullSpan_&&(h+=10),o+=S,l+=h,e.departureDatePrevious=unSpanDate_(_),e.departureDateNext=unSpanDate_(c)}});var c=0;return e.forEach(function(e){if(e.departureDate||(e.departureDate=o<=l&&e.departureDatePrevious||o>l&&!e.departureDateNext?e.departureDatePrevious:e.departureDateNext),e.departureDate){if(!/T\d{2}:\d{2}:\d{2}/i.test(e.departureDate)){for(var r=a(/(\d{2}:\d{2}(?:\s?[AP]M)?)/gi,p.getSpan().toString().replace(/\[\/?t(?:[hrd]|able)\d+]/g,"")),u=null,s=[],d=1;d<r.length;)null===u&&(u=r[d][1]-r[d-1][1]),distanceResults=t(d,r,s,u),d=distanceResults[0],r=distanceResults[1],s=distanceResults[2];var i=n(s[c]);e.departureDate=/^\d{2}:\d{2}:\d{2}$/.test(i)?e.departureDate+"T"+i:e.departureDate+"T00:00:00"}_.push(e)}c++}),_}}).call();