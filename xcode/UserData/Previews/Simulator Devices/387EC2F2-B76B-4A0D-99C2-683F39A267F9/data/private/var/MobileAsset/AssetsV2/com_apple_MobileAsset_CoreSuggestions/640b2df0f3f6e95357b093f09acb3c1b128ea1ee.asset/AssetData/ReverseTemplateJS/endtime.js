(function(){return function(e,t,n){function a(n,a){if("undefined"!=typeof e.skipEndDate){for(s=0;s<e.skipEndDate.length;s++)if(t.getSpan().next(e.skipEndDate[s]).exists()){var i=t.getSpan().next(e.skipEndDate[s]).start_,r=t.getSpan().next(e.skipEndDate[s]).end_;if(n&&n.exists()&&!a){var D=n.exists()&&n.start_?n.start_:null,l=n.exists()&&n.end_?n.end_:null;i&&l&&D>i&&l<=r&&(n=null)}else if(n.exists()&&a){var u=n.nextDate().exists()&&n.nextDate().start_?n.nextDate().start_:null,o=n.nextDate().exists()&&n.nextDate().end_?n.nextDate().end_:null;n=n.nextDate().exists()&&i&&o&&!(u>i&&o<=r)?n.nextDate():null}}if(!a)return null===n;if(a)return null===n?null:n}}var i,s,r;if(isDateTimeDuration(n)){var D=t.getDetachedSpan(t.getDateDD(n).endIso8601);if(dateTimeSpanToEpoch(n)<=dateTimeSpanToEpoch(D))return D}var l=t.getSpan().allAbsoluteDates().filter(function(n){return/[\d\uff10-\uff19]{1,2}/.test(n.toString())&&!e.footer.map(function(e){return t.getSpan().next(e)}).filter(function(e){return e.exists()}).some(function(e){return e.contains(n)})});if((r=l.filter(function(e){return isDateDuration(e)&&!hasTime(e)})).length>0){var u=t.getDetachedSpan(t.getDateDD(r[0]).endIso8601).innerDate();if(dateTimeSpanToEpoch(n)<=dateTimeSpanToEpoch(u)&&!1===a(t.getSpan().next(t.getDateDD(r[0]).text),!1))return u}if((D=(D=l.shift())&&D.toString().includes(n.toString())&&l.length>0?l.shift():t.getNullSpan())&&D.exists()&&t.getDateDD(D).endIso8601.length>0&&(D=!1===a(t.getSpan().next(t.getDateDD(D).text),!1)?t.getDetachedSpan(t.getDateDD(D).endIso8601).innerDate():null),"undefined"!=typeof e.endDate)for(s=0;s<e.endDate.length&&(!i||!i.exists());s++){var o=t.getSpan().next(e.endDate[s]);(i=o.nextAbsoluteDate()).exists()&&i.start_-o.end_<=75&&/[\d\uff10-\uff19]{1,2}/.test(i.toString())&&(D=!1===a(i,!1)?i:null)}if(D&&D.exists()&&!0===a(D,!1)&&(D=a(D,!0)),D&&D.exists()&&!hasTime(D)){var d;for(s=0;s<e.endTime.length&&(!d||!d.exists());s++)(d=t.getSpan().next(e.endTime[s]).nextDate()).exists()&&hasTime(d)?D=combineDateAndTime(D,d):d=t.getNullSpan();if(!d)for(var f=null!==(l=t.getSpan().withStart(D.getEnd()).allDates().filter(function(e){return/[\d\uff10-\uff19]{1,2}/.test(e.toString())}))?l.length:0,p=0;p<f;p++)if(hasTime(l[p])){D=combineDateAndTime(D,l[p]);break}}return Date.parse(unSpanDate_(n))>=Date.parse(unSpanDate_(D))&&(D=t.getNullSpan()),D}}).call();